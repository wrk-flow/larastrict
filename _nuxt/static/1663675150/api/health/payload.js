__NUXT_JSONP__("/api/health", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap){return {data:[{document:{slug:"health",title:"Health",category:G,toc:[{id:M,depth:z,text:G},{id:N,depth:B,text:O},{id:P,depth:z,text:Q},{id:R,depth:z,text:S},{id:T,depth:z,text:U},{id:V,depth:z,text:W},{id:X,depth:B,text:Y},{id:Z,depth:B,text:_},{id:$,depth:B,text:aa}],body:{type:"root",children:[{type:b,tag:k,props:{},children:[{type:a,value:"Health API endpoints are designed for your monitoring services."}]},{type:a,value:f},{type:b,tag:C,props:{id:"install"},children:[{type:b,tag:l,props:{href:"#install",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:"Install"}]},{type:a,value:f},{type:b,tag:ab,props:{},children:[{type:a,value:f},{type:b,tag:H,props:{},children:[{type:a,value:"Open "},{type:b,tag:ac,props:{},children:[{type:a,value:"config\u002Fapp.php"}]}]},{type:a,value:f},{type:b,tag:H,props:{},children:[{type:a,value:"Add "},{type:b,tag:j,props:{},children:[{type:a,value:"\\LaraStrict\\Health\\HealthServiceProvider::class"}]},{type:a,value:" to "},{type:b,tag:j,props:{},children:[{type:a,value:"providers"}]}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:C,props:{id:"usage"},children:[{type:b,tag:l,props:{href:"#usage",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:"Usage"}]},{type:a,value:f},{type:b,tag:A,props:{id:M},children:[{type:b,tag:l,props:{href:"#api",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:G}]},{type:a,value:f},{type:b,tag:"blockquote",props:{},children:[{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"API middlewares are turned off for all APIs."}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"The service provider exposes these endpoints:"}]},{type:a,value:f},{type:b,tag:D,props:{id:N},children:[{type:b,tag:l,props:{href:"#apihealthalive",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:O}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"This API endpoint is designed for checking if the Laravel app works. Especially we want to check NGINX -\u003E PHP-FPM\nconnection and if the Laravel is booting."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Returns JSON response "},{type:b,tag:j,props:{},children:[{type:a,value:"{\"message\": \"ok\"}"}]},{type:a,value:E}]},{type:a,value:f},{type:b,tag:A,props:{id:P},children:[{type:b,tag:l,props:{href:"#docker-compose",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:Q}]},{type:a,value:f},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,F]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"  "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"web"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"image"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" nginx"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"stable"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"alpine\n    "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"restart"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"unless-stopped\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"ports"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"80:80\""}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"443:443\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"volumes"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" .\u002Fweb"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\u002Fapp\n      "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" .\u002Fdocker\u002Fnginx\u002Fsites"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\u002Fetc\u002Fnginx\u002Fconf.d\u002F\n      "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" .\u002Fdocker\u002Fnginx\u002Fnginx.conf"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\u002Fetc\u002Fnginx\u002Fnginx.conf"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"cached\n    "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"depends_on"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" app\n      "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" mailhog\n    "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"healthcheck"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"test"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"["}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"CMD\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:I}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"curl\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:I}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"-f\""}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:I}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"http:\u002F\u002Flocalhost\u002Fapi\u002Fhealth\u002Falive\""}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"]"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"retries"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,"number"]},children:[{type:a,value:"3"}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"timeout"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" 5s\n\n"}]}]}]},{type:a,value:f},{type:b,tag:C,props:{id:"logs"},children:[{type:b,tag:l,props:{href:"#logs",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:"Logs"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"When health APIs are used by monitoring every interval we do not want to spam the access log."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"We do recommend to disable the access log for given API endpoint. Examples below will prevent logging\nany "},{type:b,tag:j,props:{},children:[{type:a,value:"\u002Fapi\u002Fhealth\u002F*"}]},{type:a,value:" call."}]},{type:a,value:f},{type:b,tag:A,props:{id:R},children:[{type:b,tag:l,props:{href:"#nginx",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:S}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"For NGINX we need to change the access_log definition in "},{type:b,tag:j,props:{},children:[{type:a,value:ad}]},{type:a,value:ae},{type:b,tag:j,props:{},children:[{type:a,value:J}]},{type:a,value:" block using "},{type:b,tag:j,props:{},children:[{type:a,value:"map"}]},{type:a,value:E}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Example below prints access log to docker output."}]},{type:a,value:f},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,af]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"http {\n    ....\n    map $request_uri $loggable {\n        ~\u002Fapi\u002Fhealth\u002F 0;\n        default 1;\n    }\n    \n    access_log \u002Fdev\u002Fstdout main_timed if=$loggable;\n    ....\n}\n"}]}]}]},{type:a,value:f},{type:b,tag:C,props:{id:"security"},children:[{type:b,tag:l,props:{href:"#security",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:"Security"}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"For security reasons you should disable access the API endpoint."}]},{type:a,value:f},{type:b,tag:A,props:{id:T},children:[{type:b,tag:l,props:{href:"#kubernetes---nginx-ingress",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:U}]},{type:a,value:f},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,F]},children:[{type:b,tag:j,props:{},children:[{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" extensions\u002Fv1beta1\n"},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"nginx.ingress.kubernetes.io\u002Fserver-snippet"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"|"}]},{type:b,tag:c,props:{className:[d,"scalar",s]},children:[{type:a,value:"\n      if ( $request_uri ~ \"^\u002Fapi\u002Fhealth\" ) { return 403; }"}]},{type:a,value:f}]}]}]},{type:a,value:f},{type:b,tag:A,props:{id:V},children:[{type:b,tag:l,props:{href:"#traefik",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:W}]},{type:a,value:f},{type:b,tag:ab,props:{},children:[{type:a,value:f},{type:b,tag:H,props:{},children:[{type:a,value:"Install "},{type:b,tag:l,props:{href:"https:\u002F\u002Fgithub.com\u002Ftraefik\u002Fplugin-blockpath",rel:["nofollow","noopener","noreferrer"],target:"_blank"},children:[{type:a,value:"blockpath plugin"}]}]},{type:a,value:f}]},{type:a,value:f},{type:b,tag:D,props:{id:X},children:[{type:b,tag:l,props:{href:"#router",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:Y}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Edit your "},{type:b,tag:ac,props:{},children:[{type:a,value:"Dynamic file configuration"}]},{type:a,value:" and add "},{type:b,tag:j,props:{},children:[{type:a,value:al}]},{type:a,value:E}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Then reference you middleware in your routes by the name "},{type:b,tag:j,props:{},children:[{type:a,value:am}]},{type:a,value:E}]},{type:a,value:f},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,F]},children:[{type:b,tag:j,props:{},children:[{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:J}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"routers"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"my-router"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"rule"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" host(`demo.localhost`)\n      "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"service"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" service"},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"foo\n      "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"entryPoints"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" web\n      "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:an}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"health\n  "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:an}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:am}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:t},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"plugin"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:L},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"blockpath"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\n          "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"regex"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:"\n            "},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:" ^\u002Fapi\u002Fhealth\u002F*\n"}]}]}]},{type:a,value:f},{type:b,tag:D,props:{id:Z},children:[{type:b,tag:l,props:{href:"#kubernetes-ingress",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:_}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"For traefik ingress I've not found how to create middleware using annotations."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"To make it add "},{type:b,tag:j,props:{},children:[{type:a,value:al}]},{type:a,value:" (from example above) in your existing dynamic file configuration and this to\nyour ingress."}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Then just add "},{type:b,tag:j,props:{},children:[{type:a,value:"traefik.ingress.kubernetes.io\u002Frouter.middlewares: block-health@file"}]},{type:a,value:" to annotations."}]},{type:a,value:f},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,F]},children:[{type:b,tag:j,props:{},children:[{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:"---"}]},{type:a,value:f},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:ag}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" networking.k8s.io\u002Fv1\n"},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:ah}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:ai},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:K},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"name"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" app\n  "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:ak}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"kubernetes.io\u002Fingress.class"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" traefik\n    "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"traefik.ingress.kubernetes.io\u002Frouter.tls"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:r},{type:b,tag:c,props:{className:[d,s]},children:[{type:a,value:"\"true\""}]},{type:a,value:u},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"traefik.ingress.kubernetes.io\u002Frouter.tls.certresolver"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:" letsencrypt\n    "},{type:b,tag:c,props:{className:[d,h,i]},children:[{type:a,value:"traefik.ingress.kubernetes.io\u002Frouter.middlewares"}]},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:g}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,e]},children:[{type:a,value:m}]},{type:a,value:"health@file\n"}]}]}]},{type:a,value:f},{type:b,tag:D,props:{id:$},children:[{type:b,tag:l,props:{href:"#proxy-nginx-server",ariaHidden:n,tabIndex:o},children:[{type:b,tag:c,props:{className:[p,q]},children:[]}]},{type:a,value:aa}]},{type:a,value:f},{type:b,tag:k,props:{},children:[{type:a,value:"Example below should be in "},{type:b,tag:j,props:{},children:[{type:a,value:J}]},{type:a,value:ae},{type:b,tag:j,props:{},children:[{type:a,value:ad}]},{type:a,value:" block. This settings should not be applied to nginx that is\nusing "},{type:b,tag:j,props:{},children:[{type:a,value:"php-fpm"}]},{type:a,value:" proxy pass."}]},{type:a,value:f},{type:b,tag:v,props:{className:[w]},children:[{type:b,tag:x,props:{className:[y,af]},children:[{type:b,tag:j,props:{},children:[{type:a,value:"if ( $request_uri ~ \"^\u002Fapi\u002Fhealth\" ) { return 403; }\n"}]}]}]}]},dir:"\u002Fen\u002Fapi",path:"\u002Fen\u002Fapi\u002Fhealth",extension:".md",createdAt:ap,updatedAt:ap,to:"\u002Fapi\u002Fhealth"},prev:{title:"Testing",path:"\u002Fen\u002Ftesting",to:"\u002Ftesting"},next:{title:"Actions",path:"\u002Fen\u002Fcore\u002Fcore",to:"\u002Fcore\u002Fcore"}}],fetch:{},mutations:[]}}("text","element","span","token","punctuation","\n",":","key","atrule","code","p","a","-","true",-1,"icon","icon-link"," ","string","\n      ","\n    ","div","nuxt-content-highlight","pre","line-numbers",2,"h2",3,"h1","h3",".","language-yaml","API","li",",","http","\n  ","\n        ","api","apihealthalive","\u002Fapi\u002Fhealth\u002Falive","docker-compose","Docker compose","nginx","Nginx","kubernetes---nginx-ingress","Kubernetes - NGINX Ingress","traefik","Traefik","router","Router","kubernetes-ingress","Kubernetes ingress","proxy-nginx-server","Proxy NGINX server","ol","strong","server"," or ","language-text","apiVersion","kind"," Ingress\n","metadata","annotations","middlewares.block-health","block-health","middlewares"," block","2022-09-20T11:58:20.839Z")));